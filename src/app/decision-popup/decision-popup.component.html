<!-- Button trigger modal -->
<div class="d-flex justify-content-center py-5">
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#decisionModal">
    Show Decision and Tasks
  </button>
</div>

<div class="modal fade decisionModal" id="decisionModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered 	modal-fullscreen modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Edit - Decision Example
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body px-2 py-1 d-flex flex-column flex-grow-1">

        <!-- tab-links -->
        <div class="tab-links d-flex">
          <h5 class="tab-link p-2" [class.active]="activeTab == 'decision'" (click)="activeTab = 'decision'">
            Decision
          </h5>
          <h5 class="tab-link p-2" [class.active]="activeTab == 'tasks'" (click)="activeTab = 'tasks'">
            Tasks
          </h5>
        </div>

        <!-- tabs -->
        <div class="tabs d-flex flex-column flex-grow-1">
          <div class="tab p-2" *ngIf="activeTab === 'decision'">
            <h5>Decision</h5>
          </div>
          <div class="tab py-2  d-flex flex-column flex-grow-1" *ngIf="activeTab === 'tasks'">

            <!-- addTask form -->
            <accordion [isAnimated]="true">
              <accordion-group [isOpen]="isOpened">
                <h6 class="tab_title" (click)="toggleForm()" accordion-heading type="button"><span>Create/Edit
                    Task</span> <span class="arrow" [ngClass]="arrow"></span> </h6>
                <form class="form_container" [formGroup]="addTaskForm">
                  <div class="row">
                    <div class="col-lg-3 col-md-6">
                      <div class="form-group">
                        <label for="title">Task title<span>*</span></label>
                        <input type="text" class="form-control" formControlName="title" required [class.error]="addTaskForm.controls['title'].errors && addTaskForm.controls['title'].touched" name="title" placeholder="Task Name" id="title">
                        <small class="text-danger" *ngIf="addTaskForm.controls['title'].errors && addTaskForm.controls['title'].touched">Required</small>
                      </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                      <div class="form-group">
                        <label for="periority">Periority<span>*</span></label>
                        <ng-select class="w-100" formControlName="periority" required [items]="task.periority" bindLabel="name" bindValue="name" [multiple]="false" name="periority" [class.error]="addTaskForm.controls['periority'].errors && addTaskForm.controls['periority'].touched" placeholder="Periority">
                        </ng-select>
                        <small class="text-danger" *ngIf="addTaskForm.controls['periority'].errors && addTaskForm.controls['periority'].touched">Required</small>

                      </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                      <div class="form-group">
                        <label for="due_date">Due Date<span>*</span></label>
                        <div class="date_group">
                          <input type="text" name='due_date' class="form-control" #dueDate="bsDatepicker" bsDatepicker [bsValue]="" [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY',containerClass :'theme-blue' }" formControlName="due_date" required [class.error]="addTaskForm.controls['due_date'].errors  && addTaskForm.controls['due_date'].touched">
                          <i class="fas fa-calendar-alt" (click)="dueDate.toggle()" [attr.aria-expanded]="dueDate.isOpen"></i>
                        </div>
                        <small class="text-danger" *ngIf="addTaskForm.controls['due_date'].errors && addTaskForm.controls['due_date'].touched">Required</small>

                      </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                      <div class="form-group">
                        <label for="reminder_date">Reminder Date</label>
                        <div class="date_group">
                          <input type="text" name='reminder_date' class="form-control" #ReminderDate="bsDatepicker" bsDatepicker [bsValue]="" [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY',containerClass :'theme-blue' }" formControlName="reminder_date" [class.error]="addTaskForm.controls['reminder_date'].errors  && addTaskForm.controls['reminder_date'].touched">
                          <i class="fas fa-calendar-alt" (click)="ReminderDate.toggle()" [attr.aria-expanded]="ReminderDate.isOpen"></i>
                        </div>

                      </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                      <div class="form-group">
                        <label for="assigne">Assigne<span>*</span></label>
                        <div class="d-flex align-items-start flex-nowrap w-100">
                          <ng-select class="custom_select" [items]="task.assigne" bindLabel="name" bindValue="name" [multiple]="true" name="assigne" placeholder="Assignee" formControlName="assigne" required [class.error]="addTaskForm.controls['assigne'].errors  && addTaskForm.controls['assigne'].touched">
                            <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                              <div class="ng-value" *ngFor="let item of items">
                                <span class="ng-value-label"> {{item.name | apprev:2}}</span>
                                <span class="ng-value-icon left" (click)="clear(item)" aria-hidden="true">×</span>
                              </div>
                            </ng-template>
                          </ng-select>
                          <div class="tooltip_icon" [tooltip]="assignePopTemplate" placement="auto" [class.disabled]="!addTaskForm.value.assigne.length">
                            {{(addTaskForm.value.assigne.length <= 2 ? 0 : '+' + (addTaskForm.value.assigne.length - 2))}} </div>
                              <ng-template #assignePopTemplate>
                                <div class="tooltip_content" *ngIf="addTaskForm.value.assigne.length">
                                  <div *ngFor="let value of addTaskForm.value.assigne; let i =index;">
                                    <div *ngIf="i>=2">
                                      {{value}}
                                    </div>
                                  </div>
                                </div>
                              </ng-template>
                          </div>

                          <small class="text-danger" *ngIf="addTaskForm.controls['assigne'].errors && addTaskForm.controls['assigne'].touched">Required</small>
                        </div>
                      </div>
                      <div class="col-lg-3 col-md-6">
                        <div class="form-group">
                          <label for="follow_up">Follow up<span>*</span></label>
                          <div class="d-flex align-items-center">
                            <ng-select class="custom_select" [items]="task.follow_up" bindLabel="name" bindValue="name" [multiple]="true" name="follow_up" placeholder="Follow up" formControlName="follow_up" required [class.error]="addTaskForm.controls['follow_up'].errors  && addTaskForm.controls['follow_up'].touched">
                              <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                <div class="ng-value" *ngFor="let item of items">
                                  <span class="ng-value-label"> {{item.name | apprev:2}}</span>
                                  <span class="ng-value-icon left" (click)="clear(item)" aria-hidden="true">×</span>
                                </div>
                              </ng-template>
                            </ng-select>

                            <div class="tooltip_icon" [tooltip]="follow_upPopTemplate" placement="auto" [class.disabled]="!addTaskForm.value.follow_up.length">
                              {{(addTaskForm.value.follow_up.length <= 2 ? 0 : '+' + (addTaskForm.value.follow_up.length - 2))}} </div>
                                <ng-template #follow_upPopTemplate>
                                  <div class="tooltip_content" *ngIf="addTaskForm.value.follow_up.length">
                                    <div *ngFor="let value of addTaskForm.value.follow_up; let i =index;">
                                      <div *ngIf="i>=2">
                                        {{value}}
                                      </div>
                                    </div>
                                  </div>
                                </ng-template>



                            </div>
                            <small class="text-danger" *ngIf="addTaskForm.controls['follow_up'].errors && addTaskForm.controls['follow_up'].touched">Required</small>

                          </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                          <div class="form-group">
                            <label for="bussiness_unit">Bussiness Unit<span>*</span></label>
                            <div class="d-flex align-items-center">
                              <ng-select class="custom_select" [items]="task.bussiness_unit" bindLabel="name" bindValue="name" [multiple]="true" name="bussiness_unit" placeholder="Bussiness Unit" formControlName="bussiness_unit" required [class.error]="addTaskForm.controls['bussiness_unit'].errors && addTaskForm.controls['bussiness_unit'].touched">
                                <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                  <div class="ng-value" *ngFor="let item of items">
                                    <span class="ng-value-label"> {{item.name | apprev:2}}</span>
                                    <span class="ng-value-icon left" (click)="clear(item)" aria-hidden="true">×</span>
                                  </div>
                                </ng-template>
                              </ng-select>
                              <div class="tooltip_icon" [tooltip]="bussiness_unitPopTemplate" placement="auto" [class.disabled]="!addTaskForm.value.bussiness_unit.length">
                                {{(addTaskForm.value.bussiness_unit.length <= 2 ? 0 : '+' + (addTaskForm.value.bussiness_unit.length - 2))}} </div>
                                  <ng-template #bussiness_unitPopTemplate>
                                    <div class="tooltip_content" *ngIf="addTaskForm.value.bussiness_unit.length">
                                      <div *ngFor="let value of addTaskForm.value.bussiness_unit; let i =index;">
                                        <div *ngIf="i>=2">
                                          {{value}}
                                        </div>
                                      </div>
                                    </div>
                                  </ng-template>
                              </div>

                              <small class="text-danger" *ngIf="addTaskForm.controls['bussiness_unit'].errors && addTaskForm.controls['bussiness_unit'].touched">Required</small>

                            </div>
                          </div>
                          <div class="col-lg-3 col-md-6">
                            <div class="form-group">
                              <label for="department">Department<span>*</span></label>
                              <div class="d-flex align-items-center">
                                <ng-select class="custom_select" [items]="task.department" bindLabel="name" bindValue="name" [multiple]="true" name="department" placeholder="Department" formControlName="department" required [class.error]="addTaskForm.controls['department'].errors  && addTaskForm.controls['department'].touched">
                                  <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                    <div class="ng-value" *ngFor="let item of items">
                                      <span class="ng-value-label"> {{item.name | apprev:2}}</span>
                                      <span class="ng-value-icon left" (click)="clear(item)" aria-hidden="true">×</span>
                                    </div>
                                  </ng-template>
                                </ng-select>
                                <div class="tooltip_icon" [tooltip]="departmentPopTemplate" placement="auto" [class.disabled]="!addTaskForm.value.department.length">
                                  {{(addTaskForm.value.department.length <= 2 ? 0 : '+' + (addTaskForm.value.department.length - 2))}} </div>
                                    <ng-template #departmentPopTemplate>
                                      <div class="tooltip_content" *ngIf="addTaskForm.value.department.length">
                                        <div *ngFor="let value of addTaskForm.value.department; let i =index;">
                                          <div *ngIf="i>=2">
                                            {{value}}
                                          </div>
                                        </div>
                                      </div>
                                    </ng-template>
                                </div>
                                <small class="text-danger" *ngIf="addTaskForm.controls['department'].errors && addTaskForm.controls['department'].touched">Required</small>

                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="form-group">
                                <label for="description">Description</label>
                                <input type="text" class="form-control" name="description" placeholder="description" id="description" formControlName="description">
                              </div>
                            </div>
                            <div class="col-md-6 d-flex flex-column">
                              <div class="mt-auto d-flex justify-content-end align-items-center">
                                <button type="button" class="btn btn-secondary " (click)="clearForm()">Clear</button>
                                <button type="button" class="btn btn-primary text-white ms-3" (click)="addTask()" [disabled]="!addTaskForm.valid">
                                  Add Task</button>
                              </div>
                            </div>
                          </div>
                </form>
              </accordion-group>
            </accordion>

            <!-- no tasks -->
            <div class="no-task p-3 d-flex flex-column flex-grow-1 justify-content-center align-items-center" *ngIf="!addedTasks.length">
              <i class="fas fa-info-circle mb-2"></i>
              <h5 class="mb-0">
                No Tasks Added
              </h5>
            </div>
            <!-- Tasks List -->
            <app-tasks-list *ngIf="addedTasks.length" [tasksList]="addedTasks">
            </app-tasks-list>

          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary " data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary ms-3">Send message</button>
      </div>

    </div>
  </div>
</div>
